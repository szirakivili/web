<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Űrbéli dolgok</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #0f1117;
      --card: #1c1f26;
      --text: #e0e4ef;
      --accent: #00b7ff;
      --border: #2a2d35;
      --subtle-text: #9ba1b4;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      padding: 2rem;
      line-height: 1.6;
    }

    .container {
      max-width: 800px;
      margin: auto;
    }

    h2 {
      margin-bottom: 1rem;
      color: var(--accent);
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      border-bottom: 2px solid var(--border);
      padding-bottom: 0.5rem;
    }
    
    #docked-objects-container {
      margin-top: 1rem;
    }

    .button-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    #fetch-button {
      background-color: var(--accent);
      color: var(--bg);
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    #fetch-button:hover:not(:disabled) {
      background-color: #0099e6;
      transform: translateY(-2px);
    }
    
    #fetch-button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
      opacity: 0.7;
    }

    #map {
      width: 100%;
      height: 400px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 183, 255, 0.2);
      margin-bottom: 2rem;
      border: 1px solid var(--border);
    }

    .object-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 1rem;
    }

    .object-card {
      background-color: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .object-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 183, 255, 0.15);
      border-color: var(--accent);
    }

    .object-name {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .object-name h3 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }

    .object-id {
      font-size: 0.8rem;
      color: var(--subtle-text);
      font-weight: 400;
      background-color: var(--border);
      padding: 0.2rem 0.5rem;
      border-radius: 8px;
    }

    .object-info p {
      font-size: 0.9rem;
      color: var(--subtle-text);
      margin: 0.25rem 0;
    }

    .object-info p strong {
      color: var(--accent);
      font-weight: 600;
    }

    @media (max-width: 600px) {
      body {
        padding: 1rem;
      }
      .object-list {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F7NERFLG67"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-F7NERFLG67');
</script>
<body>
  <div class="container">
    <div id="apod-section" class="object-card" style="margin-bottom: 2rem;">
      <h2>
        A nap csillagászati képe a NASA-tól
        <span class="object-id" style="margin: 5px; cursor: pointer;" onclick="window.open('https://apod.nasa.gov/apod/')">Forrás</span>
      </h2>
      <div id="apod-content">Betöltés...</div>
    </div>
    
    <h2>A Nemzetközi Űrállomás aktuális pozíciója</h2>
    <div id="map"></div>
    <div id="iss-info" class="object-card" style="margin-bottom: 2rem;"></div>

    <h2>Űrállomások és dokkolt járművek az űrben</h2>
    <div id="docked-objects-container">
      <button id="fetch-button">Lista betöltése</button>
      <div id="objects" class="object-list"></div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let marker = null;
    let issCircle = null;

    function formatTimeAgo(isoString) {
      const then = new Date(isoString);
      const now = new Date();
      const diffMs = now - then;

      const seconds = Math.floor(diffMs / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);

      if (days > 0) return `${days} napja`;
      if (hours > 0) return `${hours} órája`;
      if (minutes > 0) return `${minutes} perce`;
      return `${seconds} másodperce`;
    }

    const map = L.map('map', {
      zoomControl: false,       // gombok eltávolítása
      dragging: false,          // egér húzás tiltása
      scrollWheelZoom: false,   // egérgörgős zoom tiltása
      doubleClickZoom: false,   // dupla kattintásos zoom tiltása
      touchZoom: false,         // érintéses zoom tiltása
      boxZoom: false,           // kijelöléses zoom tiltása
      keyboard: false           // billentyűzet vezérlés tiltása
    });
    map.setView([0, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const issIcon = L.icon({
      iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/d/d0/International_Space_Station.svg',
      iconSize: [70, 45],
      iconAnchor: [35, 22.5]
    });

    async function updateISSPosition() {
      try {
        const response = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
        const data = await response.json();
        const lat = data.latitude;
        const lon = data.longitude;

        if (!marker) {
          marker = L.marker([lat, lon], { icon: issIcon }).addTo(map);
          marker.bindPopup("ISS");
          issCircle = L.circle([lat, lon], {
            radius: 1700000,
            color: '#00b7ff',
            fillColor: '#00b7ff',
            fillOpacity: 0.2,
            weight: 1
          }).addTo(map);
        } else {
          marker.setLatLng([lat, lon]);
          issCircle.setLatLng([lat, lon]);
        }

        map.setView([lat, lon], 2);
        renderISSInfo(data);
      } catch (error) {
        console.error('Hiba az ISS pozíció lekérdezésénél:', error);
      }
    }

    const issInfoDiv = document.getElementById('iss-info');

    function renderISSInfo(data) {
      const visibility = data.visibility === 'daylight' ? 'nappali' : 'éjszakai';
      issInfoDiv.innerHTML = `
        <div class="object-name">
        <h3>ISS</h3>
        <span class="object-id">ID: ${data.id}</span>
        </div>
        <div class="object-info">
        <p>Magasság: <strong>${data.altitude.toFixed(1)} km</strong></p>
        <p>Sebesség: <strong>${data.velocity.toFixed(0)} km/h</strong></p>
        <p>Láthatóság: <strong>${visibility}</strong></p>
        </div>
    `;
    }

    async function fetchDockedObjects() {
      const listContainer = document.getElementById('objects');
      const button = document.getElementById('fetch-button');

      button.disabled = true;
      button.textContent = 'Betöltés...';

      try {
        const response = await fetch('https://celestrak.org/NORAD/elements/gp.php?GROUP=stations&FORMAT=json');
        const data = await response.json();

        data.sort((a, b) => b.OBJECT_ID.localeCompare(a.OBJECT_ID));
        listContainer.innerHTML = '';

        data.forEach(obj => {
          const div = document.createElement('div');
          div.className = 'object-card';
          div.innerHTML = `
            <div class="object-name">
              <h3>${obj.OBJECT_NAME}</h3>
              <span class="object-id">${obj.OBJECT_ID}</span>
            </div>
            <div class="object-info">
              <p>Frissítve: <strong>${formatTimeAgo(obj.EPOCH)}</strong></p>
              <p>Keringési pálya szöge: <strong>${obj.INCLINATION}°</strong></p>
            </div>
          `;
          listContainer.appendChild(div);
        });
        button.style.display = 'none';
      } catch (error) {
        console.error('Nem sikerült lekérni a dokkolt objektumokat:', error);
        button.textContent = 'Hiba történt';
        button.disabled = false;
      }
    }

    async function fetchAPOD() {
      const apodDiv = document.getElementById('apod-content');
      try {
        const response = await fetch('https://api.nasa.gov/planetary/apod?api_key=RNbnPzZa0FI95pg1kH0MOtYh8dHBUada1cMG1FbE');
        const data = await response.json();

        if (data.media_type !== 'image') {
          apodDiv.innerHTML = '<p>Mai napra nincs elérhető kép.</p>';
        } else {
          apodDiv.innerHTML = `
          <a href="${data.hdurl}" target="_blank" style="display:block; margin-bottom:1rem;">
            <img src="${data.url}" alt="${data.title}" style="max-width:100%; border-radius:12px; border: 1px solid var(--border); box-shadow: 0 4px 15px rgba(0, 183, 255, 0.1);" />
          </a>`;
        }

        apodDiv.innerHTML += `
          <h3 style="color: var(--accent); font-size: 1.10rem; margin-bottom: 0.5rem;">${data.title}</h3>
          <p style="font-size: 0.95rem; color: var(--subtle-text);">${data.explanation}</p>
        `;
      } catch (err) {
        console.error('Nem sikerült lekérni a NASA képét:', err);
        apodDiv.innerHTML = '<p>Hiba történt a kép betöltésekor.</p>';
      }
    }

    fetchAPOD();

    updateISSPosition();
    setInterval(updateISSPosition, 5000);
    
    const fetchButton = document.getElementById('fetch-button');
    fetchButton.addEventListener('click', fetchDockedObjects);
  </script>
</body>
</html>