<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Űrbéli dolgok</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #0f1117;
      --card: #1c1f26;
      --text: #e0e4ef;
      --accent: #00b7ff;
      --border: #2a2d35;
      --subtle-text: #9ba1b4;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      padding: 2rem;
      line-height: 1.6;
    }

    .container {
      max-width: 800px;
      margin: auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    h2 {
      margin-bottom: 1rem;
      color: var(--accent);
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      border-bottom: 2px solid var(--border);
      padding-bottom: 0.5rem;
      cursor: pointer;
      position: relative;
      padding-right: 1.2rem;
    }
    h2::before {
      content: "▽";
      position: absolute;
      right: 0;
      color: var(--subtle-text);
      transition: transform 0.3s ease;
    }
    h2.open::before {
      transform: rotate(180deg);
      color: var(--accent);
    }

    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
    }

    .sources {
      text-align: center;
    }

    .sources-title {
      margin-bottom: 1rem;
      color: var(--accent);
      font-size: 0.9rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 0.5rem;
    }

    .sources p, .sources a {
      color: var(--subtle-text);
      font-size: 0.7rem;
      text-decoration: none;
    }
    
    #docked-objects-container {
      margin-top: 1rem;
    }

    #map {
      width: 100%;
      height: 400px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 183, 255, 0.2);
      margin-bottom: 2rem;
      border: 1px solid var(--border);
    }

    .object-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 1rem;
    }

    .object-card {
      background-color: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .object-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 183, 255, 0.15);
      border-color: var(--accent);
    }

    .object-name {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .object-name h3 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }

    .object-id {
      font-size: 0.8rem;
      color: var(--subtle-text);
      font-weight: 400;
      background-color: var(--border);
      padding: 0.2rem 0.5rem;
      border-radius: 8px;
      white-space: nowrap;
    }

    .object-info p {
      font-size: 0.9rem;
      color: var(--subtle-text);
      margin: 0.25rem 0;
    }

    .object-info p strong {
      color: var(--accent);
      font-weight: 600;
    }

    .object-info h4 {
      font-size: 1rem;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }

    .status-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: var(--border);
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--accent);
    }

    .launch-logos {
      display: flex;
      flex-wrap: wrap; /* új sor, ha nem fér ki */
      gap: 0.5rem;
    }

    .launch-logo-patch {
      max-width: 100px;
      max-height: 100px;
      object-fit: contain;
    }
    .launch-logo-image {
      max-width: 100px;
      max-height: 100px;
      object-fit: contain;
      margin-bottom: 0.5rem;
      border-radius: 5%;
    }

    .station-logos {
      display: flex;
      flex-wrap: wrap; /* új sor, ha nem fér ki */
      gap: 0.5rem;
    }
    .station-logo-patch {
      max-width: 75px;
      max-height: 50px;
      object-fit: contain;
    }
    .station-image {
      width: 100%;
      border-radius: 5%;
      margin-bottom: 20px;
    }
    
    .astronaut-image {
      max-width: 50%;
      border-radius: 5%;
      margin-bottom: 20px;
    }

    .crew-list {
      margin-top: 0.5rem;
    }

    .crew-list h4 {
      font-size: 1rem;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }

    .crew-list ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    .crew-list li {
      position: relative;
      padding-left: 1.5rem;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      color: var(--subtle-text);
    }

    .crew-list li strong {
      color: var(--accent);
      font-weight: 600;
    }

    .crew-list li::before {
      content: "✦";              /* egyszerű, modern "csillag" ikon */
      position: absolute;
      left: 0;
      color: var(--accent);
      font-size: 0.9rem;
    }

    .flight-data-list {
      margin-top: 0.5rem;
    }

    .flight-data-list h4 {
      font-size: 1rem;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }

    .flight-data-list ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    .flight-data-list ol {
      list-style-position: inside;
    }
    .flight-data-list ol ul {
      list-style: none;
      padding-left: 2rem;
      margin: 0;
    }

    .flight-data-list ol li, .flight-data-list ol ul li  {
      position: relative;
      padding-left: 1rem;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      color: var(--subtle-text);
    }

    .flight-data-list li strong {
      color: var(--accent);
      font-weight: 600;
    }
    
    .flight-data-list ul li::before {
      content: "✦";              /* egyszerű, modern "csillag" ikon */
      position: absolute;
      left: 0;
      color: var(--accent);
      font-size: 0.9rem;
    }

    @media (max-width: 600px) {
      body {
        padding: 1rem;
      }
      .object-list {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F7NERFLG67"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-F7NERFLG67');
</script>
<body>
  <h1>Világűr ✨</h1>

  <div class="container">
    <h2>
        A nap csillagászati képe <span class="object-id" style="margin: 5px; cursor: pointer;" onclick="window.open('https://apod.nasa.gov/apod/')">Forrás: NASA</span>
      </h2>
    <div id="apod-section" class="object-card" style="margin-bottom: 2rem;">
      <div id="apod-content">Betöltés...</div>
    </div>
    
    <h2>A Nemzetközi Űrállomás aktuális pozíciója <span class="object-id" style="margin: 5px;">Folyamatosan frissül</span></h2>
    <div id="map"></div>
    <div id="iss-info" class="object-card" style="margin-bottom: 2rem;"></div>

    <h2>Közelgő személyzet nélküli kilövések <span id="uncrewed-refresh" class="object-id" style="margin: 5px;">Frissítve: -</span></h2>
    <div id="launches-container">
      <div id="launches" class="object-list" style="margin-bottom:2rem;"></div>
    </div>

    <h2>Közelgő emberes kilövések <span id="crewed-refresh" class="object-id" style="margin: 5px;">Frissítve: -</span></h2>
    <div id="launches-container">
      <div id="crewed-launches" class="object-list" style="margin-bottom:2rem;"></div>
    </div>

    <h2>Aktív űrállomások <span id="station-refresh" class="object-id" style="margin: 5px;">Frissítve: -</span></h2>
    <div id="launches-container">
      <div id="stations" class="object-list" style="margin-bottom:2rem;"></div>
    </div>

    <h2>Magyar űrhajósok</h2>
    <div id="launches-container">
      <div id="hungarians" class="object-list" style="margin-bottom:2rem;"></div>
    </div>
  </div>

  <div class="sources">
    <p>Források: <a href="https://apod.nasa.gov/apod/">NASA APOD</a>; 
    <a href="https://wheretheiss.at/">ISS pozíció</a>; 
    <a href="https://thespacedevs.com/">Kilövések, űrállomások, űrhajósok</a></p>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let marker = null;
    let issCircle = null;

    function formatTimeAgo(isoString) {
      const then = new Date(isoString);
      const now = new Date();
      const diffMs = now - then;
      const seconds = Math.floor(diffMs / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);

      if (days > 0) return `${days} napja`;
      if (hours > 0) return `${hours} órája`;
      if (minutes > 0) return `${minutes} perce`;
      return `${seconds} másodperce`;
    }

    function formatCountdown(isoString) {
      const launchDate = new Date(isoString);
      const now = new Date();
      let diff = (launchDate - now) / 1000; // másodpercben
      if (diff <= 0) return "Már elindult";

      const days = Math.floor(diff / 86400);
      diff %= 86400;
      const hours = Math.floor(diff / 3600);
      diff %= 3600;
      const minutes = Math.floor(diff / 60);
      const seconds = Math.floor(diff % 60);

      const dd = String(days).padStart(2, '0');
      const hh = String(hours).padStart(2, '0');
      const mm = String(minutes).padStart(2, '0');
      const ss = String(seconds).padStart(2, '0');

      return `T-${dd}:${hh}:${mm}:${ss}`;
    }

    function formatLaunchDate(isoString, precision) {
      const date = new Date(isoString);

      const months = [
        "január", "február", "március", "április", "május", "június",
        "július", "augusztus", "szeptember", "október", "november", "december"
      ];

      const pad = (n) => String(n).padStart(2, "0");

      let formatted = "";

      switch (precision) {
        case "Y":
          formatted = `${date.getFullYear()}`;
          break;

        case "M":
          formatted = `${date.getFullYear()}. ${months[date.getMonth()]}`;
          break;

        case "DAY":
          formatted = `${date.getFullYear()}. ${months[date.getMonth()]} ${date.getDate()}.`;
          break;

        case "HR":
          formatted = `${date.getFullYear()}. ${months[date.getMonth()]} ${date.getDate()}. ${pad(date.getHours())}:00`;
          break;

        case "MIN":
          formatted = `${date.getFullYear()}. ${months[date.getMonth()]} ${date.getDate()}. ${pad(date.getHours())}:${pad(date.getMinutes())}`;
          break;

        case "SEC":
          formatted = `${date.getFullYear()}. ${months[date.getMonth()]} ${date.getDate()}. ${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
          break;

        case "Q1":
        case "Q2":
        case "Q3":
        case "Q4": 
          formatted = `${date.getFullYear()}. ${precision[1]}. negyedév`;
          break;

        case "H1":
        case "H2": 
          formatted = `${date.getFullYear()}. ${precision[1]}. fele`;
          break;

        default:
          formatted = `Ismeretlen (${date.toLocaleString("hu-HU")}`; // fallback: teljes dátum/idő magyarul
      }

      return formatted;
    }

    function parseISODuration(duration) {
      const regex = /P(?:(\d+)D)?T?(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/;
      const matches = duration.match(regex);

      const days = parseInt(matches[1] || 0, 10);
      const hours = parseInt(matches[2] || 0, 10);
      const minutes = parseInt(matches[3] || 0, 10);
      const seconds = parseInt(matches[4] || 0, 10);

      return `${days > 0 ? `${days} nap ` : ""}${hours > 0 ? `${hours} óra ` : ""}${minutes > 0 ? `${minutes} perc ` : ""}${seconds > 0 ? `${seconds} mp ` : ""}`;
    }

    const map = L.map('map', {
      zoomControl: false,
      dragging: false,
      scrollWheelZoom: false,
      doubleClickZoom: false,
      touchZoom: false,
      boxZoom: false,
      keyboard: false
    });
    map.setView([0, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const issIcon = L.icon({
      iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/d/d0/International_Space_Station.svg',
      iconSize: [70, 45],
      iconAnchor: [35, 22.5]
    });

    async function fetchWithTimeout(url, timeout = 3000) {
      return Promise.race([
        fetch(url),
        new Promise((_, reject) => setTimeout(() => reject(new Error("timeout")), timeout))
      ]);
    }

    async function updateISSPosition() {
      try {
        let data, lat, lon, weakAPI = false;
        try {
          const response = await fetchWithTimeout('https://api.wheretheiss.at/v1/satellites/25544', 3000);
          if (!response.ok) throw new Error("Első API hibás választ adott");
          data = await response.json();
          lat = data.latitude;
          lon = data.longitude;
        } catch (err) {
          console.warn("Első API nem válaszolt:", err.message);
          const response = await fetch('http://api.open-notify.org/iss-now.json');
          if (!response.ok) throw new Error("Második API hibás választ adott");
          data = await response.json();
          lat = data.iss_position.latitude;
          lon = data.iss_position.longitude;
          weakAPI = true;
        }

        if (!marker) {
          marker = L.marker([lat, lon], { icon: issIcon }).addTo(map);
          marker.bindPopup("ISS");
          issCircle = L.circle([lat, lon], {
            radius: 1700000,
            color: '#00b7ff',
            fillColor: '#00b7ff',
            fillOpacity: 0.2,
            weight: 1
          }).addTo(map);
        } else {
          marker.setLatLng([lat, lon]);
          issCircle.setLatLng([lat, lon]);
        }

        map.setView([lat, lon], 2);
        renderISSInfo(data, weakAPI);

      } catch (error) {
        console.error('Hiba az ISS pozíció lekérdezésénél:', error);
      }
    }

    const issInfoDiv = document.getElementById('iss-info');
    function renderISSInfo(data, weakAPI = false) {
      if (!weakAPI) {
        const visibility = data.visibility === 'daylight' ? 'nappali' : 'éjszakai';
        issInfoDiv.innerHTML = `
          <div class="object-name">
            <h3>ISS</h3>
            <span class="object-id">ID: ${data.id}</span>
          </div>
          <div class="object-info">
            <p>Magasság: <strong>${data.altitude.toFixed(1)} km</strong></p>
            <p>Sebesség: <strong>${data.velocity.toFixed(0)} km/h</strong></p>
            <p>Láthatóság: <strong>${visibility}</strong></p>
          </div>
        `;
      } else {
        issInfoDiv.innerHTML = `
          <div class="object-name">
            <h3>ISS</h3>
          </div>
          <div class="object-info">
            <p>A wheretheiss.at oldal nem válaszol. <strong>Részletes információk nem érhetők el.</strong></p>
          </div>
        `;
      }
    }

    async function fetchLaunches(isCrewed = false) {
      const container = document.getElementById(`${isCrewed ? "crewed-" : ""}launches`);
      const refreshTimeLabel = document.getElementById(`${isCrewed ? "" : "un"}crewed-refresh`);

      try {
        const response = await fetch(`upcoming_${isCrewed ? "" : "un"}crewed_launches.json`); // https://ll.thespacedevs.com/2.3.0/launches/upcoming/?is_crewed=${isCrewed}&format=json&mode=detailed&limit=10
        const file = await response.json();
        const data = file.payload;
        container.innerHTML = "";

        refreshTimeLabel.textContent = `Frissítve: ${formatTimeAgo(file.fetched_at, 'MIN')}`;

        /*if (data.detail) {
          let waitSec = data.detail.split(" ")[6];
          container.innerHTML = `<p>Próbáld újra ${waitSec} mp múlva!</p>`;
          return;
        }*/

        data.results.forEach((launch, index) => {
          const div = document.createElement("div");
          div.className = "object-card";
          
          let logo = "";
          let logoClass = "";
          if (launch.mission_patches && launch.mission_patches.length > 0) {
            launch.mission_patches.forEach((patch) => {
              logo += `<img class="launch-logo-patch" src="${patch.image_url}" alt="${patch.name}" />`;
            });
          } else if (launch.program && launch.program.length > 0 && launch.program[0].image) {
            logo = `<img class="launch-logo-image" src="${launch.program[0].image.image_url}" alt="${launch.program[0].image.name}" />`;
          } else if (launch.image) {
            logo = `<img class="launch-logo-image" src="${launch.image.image_url}" alt="${launch.image.name}" />`;
          }

          let crew = "";
          if (isCrewed && launch.rocket && launch.rocket.spacecraft_stage && launch.rocket.spacecraft_stage.length > 0 && launch.rocket.spacecraft_stage[0].launch_crew && launch.rocket.spacecraft_stage[0].launch_crew.length > 0)
          {
            launch.rocket.spacecraft_stage[0].launch_crew.forEach(member => {
              crew += `<li>${member.role.role || "Űrhajós"}: <strong>${member.astronaut.name}</strong> (${member.astronaut.nationality[0].alpha_2_code || "?"})</li>`;
            });
          }

          let agencies = "";
          if (launch.launch_service_provider?.logo?.image_url) {
            agencies += `<img class="station-logo-patch" src="${launch.launch_service_provider?.logo?.image_url}" alt="${launch.launch_service_provider?.name || ""}" />`;
          }
          if (launch.mission?.agencies && launch.mission.agencies.length > 0) {
            launch.mission.agencies.forEach(agency => {
              if (!agencies.includes(agency.name)) {
                agencies += `<img class="station-logo-patch" src="${agency.logo?.image_url}" alt="${agency.name || ""}" />`;
              }
            });
          }

          // minden launch-hoz adunk egy egyedi ID-t a visszaszámlálóhoz
          const countdownId = `countdown-${isCrewed ? "C" : "UC"}${index}`;

          div.innerHTML = `
            <span class="status-badge">${launch.status?.name || launch.status?.abbrev || ""}</span>
            <div class="launch-logos">${logo ? logo : ""}</div>
            <div class="object-name">
              <h3>${launch.name}</h3>
            </div>
            <div class="object-info">
              <h4><strong id="${countdownId}">${formatCountdown(launch.net)}</strong></h4>
              <p>Indítás időpontja: <strong>${formatLaunchDate(launch.net, launch.net_precision?.abbrev || null)}</strong></p>
              <p>Helyszín: <strong>${launch.pad?.location?.name || launch.pad?.name || "Ismeretlen"}</strong> (${launch.location_launch_attempt_count_year}. kilövés az évben)</p>
              <p>Szolgáltató: <strong>${launch.launch_service_provider?.name || "N/A"}</strong> (${launch.agency_launch_attempt_count_year}. kilövés az évben)</p>
              <p>Keringési pálya: <strong>${launch.mission?.orbit?.name || "-"}</strong> (${launch.mission?.orbit?.abbrev || ""})</p>
              ${isCrewed ? `<div class="crew-list">
                  <h4>Személyzet:</h4>
                  <ul>${crew}</ul>
                </div>` : ""}
              <h4>A küldetésről:</h4>
              <p>${launch.mission?.description || "-"}</p>
              <p class="object-id" style="margin-top: 15px; cursor: pointer; width: fit-content;" onclick="window.open('https://go4liftoff.com/launch/${launch.slug}')">További információk</p>
              <div class="station-logos" style="margin-top: 10px;">${agencies ? agencies : ""}</div>
            </div>
          `;
          container.appendChild(div);

          // indítjuk a frissítőt az adott launch-hoz
          const countdownEl = document.getElementById(countdownId);
          setInterval(() => {
            countdownEl.textContent = formatCountdown(launch.net);
          }, 1000);
        });

      } catch (err) {
        console.error("Nem sikerült lekérni a kilövéseket:", err);
        container.innerHTML = "<p>Nem sikerült betölteni a kilövéseket.</p>";
      }
    }

    async function fetchStations() {
      const container = document.getElementById('stations');
      const refreshTimeLabel = document.getElementById(`station-refresh`);

      try {
        const response = await fetch(`stations_and_expeditions.json`); // https://ll.thespacedevs.com/2.3.0/space_stations/?mode=detailed&status=1&format=json
        const file = await response.json();
        const data = file.payload;
        container.innerHTML = "";

        refreshTimeLabel.textContent = `Frissítve: ${formatTimeAgo(file.fetched_at, 'MIN')}`;

        /*if (data.detail) {
          let waitSec = data.detail.split(" ")[6];
          container.innerHTML = `<p>Próbáld újra ${waitSec} mp múlva!</p>`;
          return;
        }*/

        for (const station of data) {
          const div = document.createElement("div");
          div.className = "object-card";
          
          let logo = "";
          let owners = [];
          if (station.owners && station.owners.length > 0) {
            station.owners.forEach((owner) => {
              logo += `<img class="station-logo-patch" src="${owner.logo.image_url || ""}" alt="${owner.name}" />`;
              owners.push(`${owner.name} (${owner.abbrev})`);
            });
          }

          let dockedVehicles = "";
          station.docking_location.forEach(dock => {
            if (dock.currently_docked !== null) {
              dockedVehicles += `<li>${dock.name}: <strong>${dock.currently_docked.flight_vehicle_chaser.spacecraft.name}</strong> (${formatTimeAgo(dock.currently_docked.docking)} dokkolt)</li>`;
            }
          });

          let expeditions = [];
          let crew = "";
          let missionPatches = "";
          // Expedíciók betöltése
          for (const exp of station.expeditions_data) { // const exp of station.active_expeditions
            expeditions.push(exp.name);
            //const response = await fetch(exp.url);
            //const expData = await response.json();

            if (exp.detail) {
              let waitSec = exp.detail.split(" ")[6];
              crew = `<li>Személyzet betöltése sikertelen, próbáld újra ${waitSec} mp múlva!</li>`;
            } else {
              exp.crew.forEach(memb => {
                crew += `<li>${memb.role.role || "Űrhajós"}: <strong>${memb.astronaut.name}</strong> (${memb.astronaut.nationality[0].alpha_2_code})</li>`;
              });
              exp.mission_patches.forEach(patch => {
                missionPatches += `<img class="launch-logo-patch" src="${patch.image_url}">`;
              });
            }
          }

          div.innerHTML = `
            <img class="station-image" src="${station.image.image_url}" />
            <div class="object-name">
              <h3>${station.name}</h3>
            </div>
            <div class="object-info">
              <p>Üzemelés kezdete: <strong>${station.founded}</strong></p>
              <p>Méret: <strong>${station.width} × ${station.height} méter</strong>, <strong>${station.mass} tonna</strong></p>
              <p>Lakható térfogat: <strong>${station.volume} m³</strong></p>
              <div class="launch-logos">${missionPatches ? missionPatches : ""}</div>
              <div class="crew-list">
                <h4>Személyzet: ${station.onboard_crew} fő (${expeditions.join(', ')})</h4>
                <ul>${crew}</ul>
              </div>
              <div class="crew-list">
                <h4>Dokkolt járművek:</h4>
                <ul>${dockedVehicles}</ul>
              </div>
              <p>Hely: <strong>${station.orbit || "ismeretlen"}</strong></p>
              <p>Tulajdonos: <strong>${owners.join('</strong>, <strong>')}</strong></p>
            </div>
            <div class="station-logos">${logo ? logo : ""}</div>
          `;
          container.appendChild(div);
        }

      } catch (err) {
        console.error("Nem sikerült lekérni az űrállomásokat:", err);
        container.innerHTML = "<p>Nem sikerült betölteni az űrállomásokat.</p>";
      }
    }

    async function fetchHungarians() {
      const container = document.getElementById('hungarians');

      try {
        const response = await fetch('./hungarians.json'); // https://ll.thespacedevs.com/2.3.0/astronauts/?mode=detailed&format=json&nationality=Hungarian
        const data = await response.json();
        container.innerHTML = "";

        if (data.detail) {
          let waitSec = data.detail.split(" ")[6];
          container.innerHTML = `<p>Próbáld újra ${waitSec} mp múlva!</p>`;
          return;
        }

        data.results.forEach(astronaut => {
          const div = document.createElement("div");
          div.className = "object-card";

          let flights = "";
          if (astronaut.landings && astronaut.landings.length > 0) {
            astronaut.landings.forEach((flight, index) => {
              launch = astronaut.flights[astronaut.flights.length - index - 1];
              
              flights += `
                <li><strong>${launch.mission.name}</strong></li>
                <ul>
                  <li>Úticél: <strong>${flight.destination}</strong></li>
                  <li>Űrhajó: <strong>${flight.spacecraft.name}</strong> (${flight.spacecraft.spacecraft_config.agency.abbrev})</li>
                  <li>Indítás: <strong>${formatLaunchDate(launch.net, "MIN")}</strong></li>
                  <ul>
                    <li>Hely: <strong>${launch.pad.location.name}</strong></li>
                    <li>Rakéta: <strong>${launch.rocket.configuration.full_name}</strong></li>
                    <li>Szolgáltató: <strong>${launch.launch_service_provider.name}</strong></li>
                  </ul>
                  <li>Landolás: <strong>${formatLaunchDate(flight.mission_end, "MIN")}</strong></li>
                  <ul>
                    <li>Hely: <strong>${flight.landing.landing_location.name}</strong></li>
                  </ul>
                </ul>
              `
            });
          }

          div.innerHTML = `
            <div class="launch-logos"><img class="astronaut-image" src="${astronaut.image.image_url}" alt="${astronaut.image.name}" /></div>
            <div class="object-name">
              <h3>${astronaut.name}</h3>
            </div>
            <div class="object-info">
              <p><strong>${astronaut.bio}</strong></p>
              <p>Születési dátum: <strong>${astronaut.date_of_birth}</strong></p>
              <p>Űrben töltött idő: <strong>${parseISODuration(astronaut.time_in_space)}</strong></p>
              <div class="flight-data-list">
                <h4>Repülések: ${astronaut.flights_count}</h4>
                <ol>${flights}</ol>
              </div>
            </div>
          `;
          container.appendChild(div);
        });

      } catch (err) {
        console.error("Nem sikerült lekérni a kilövéseket:", err);
        container.innerHTML = "<p>Nem sikerült betölteni a kilövéseket.</p>";
      }
    }

    async function fetchAPOD() {
      const apodDiv = document.getElementById('apod-content');
      try {
        const response = await fetch('https://api.nasa.gov/planetary/apod?api_key=RNbnPzZa0FI95pg1kH0MOtYh8dHBUada1cMG1FbE');
        const data = await response.json();

        if (data.media_type !== 'image') {
          apodDiv.innerHTML = '<p>Mai napra nincs elérhető kép.</p>';
        } else {
          apodDiv.innerHTML = `
          <a href="${data.hdurl}" target="_blank" style="display:block; margin-bottom:1rem;">
            <img src="${data.url}" alt="${data.title}" style="max-width:100%; border-radius:12px; border: 1px solid var(--border); box-shadow: 0 4px 15px rgba(0, 183, 255, 0.1);" />
          </a>`;
        }

        apodDiv.innerHTML += `
          <h3 style="color: var(--accent); font-size: 1.10rem; margin-bottom: 0.5rem;">${data.title}</h3>
          <p style="font-size: 0.95rem; color: var(--subtle-text);">${data.explanation}</p>
        `;
      } catch (err) {
        console.error('Nem sikerült lekérni a NASA képét:', err);
        apodDiv.innerHTML = '<p>Hiba történt a kép betöltésekor.</p>';
      }
    }

    fetchAPOD();

    updateISSPosition();
    setInterval(updateISSPosition, 5000);

    fetchLaunches();
    fetchLaunches(true);
    fetchStations();
    fetchHungarians();

    // ÖSSZECSUKHATÓ PANELEK
    document.addEventListener("DOMContentLoaded", () => {
      const headers = document.querySelectorAll("h2:not(.sources-title)");

      headers.forEach(h2 => {
        // minden h2 után összegyűjtjük a tartalmat a következő h2-ig
        let content = [];
        let sibling = h2.nextElementSibling;
        while (sibling && sibling.tagName !== "H2") {
          content.push(sibling);
          sibling = sibling.nextElementSibling;
        }

        // becsomagoljuk egy div-be
        let wrapper = null;
        if (content.length > 0) {
          wrapper = document.createElement("div");
          wrapper.classList.add("collapsible-content");
          content[0].before(wrapper);
          content.forEach(el => wrapper.appendChild(el));
        }

        // kattintásra nyit/zár
        h2.addEventListener("click", () => {
          if (!wrapper) return;

          if (h2.classList.contains("open")) {
            // összecsukás
            wrapper.style.maxHeight = wrapper.scrollHeight + "px"; // fixáljuk először
            requestAnimationFrame(() => {
              wrapper.style.maxHeight = "0";
            });
            h2.classList.remove("open");
          } else {
            // kinyitás
            wrapper.style.maxHeight = wrapper.scrollHeight + "px";
            h2.classList.add("open");

            // ha bezárás után újra kinyitjuk, engedjük hogy "auto"-ra álljon
            wrapper.addEventListener("transitionend", function setAuto(e) {
              if (h2.classList.contains("open")) {
                wrapper.style.maxHeight = "none";
              }
              wrapper.removeEventListener("transitionend", setAuto);
            });
          }
        });
      });
    });
  </script>
</body>
</html>
