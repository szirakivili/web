<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Állomás kereső</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    #results {
      margin-top: 20px;
      max-width: 600px;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <form id="searchForm">
    <input type="text" id="stationInput" placeholder="Írd be az állomás nevét..." required>
    <button type="submit">Keresés</button>
  </form>

  <div id="results"></div>

  <script>
    const form = document.getElementById('searchForm');
    const input = document.getElementById('stationInput');
    const resultsDiv = document.getElementById('results');

    // Elküldésre navigáljon új URL-re station paraméterrel
    form.addEventListener('submit', e => {
      e.preventDefault();
      const station = input.value.trim();
      if (station) {
        const encoded = encodeURIComponent(station);
        window.location.search = `?station=${encoded}`;
      }
    });

    // Lekérés és megjelenítés, ha van station paraméter
    const params = new URLSearchParams(window.location.search);
    const stationParam = params.get('station');

    if (stationParam) {
      fetch(`https://apiv2.oroszi.net/elvira/leaderboard?station=${encodeURIComponent(stationParam)}`)
        .then(res => res.json())
        .then(data => {
          const stationName = data.station || 'Ismeretlen állomás';
          const trains = data.trains || [];

          let html = `<h2>${stationName}</h2>`;
          if (trains.length === 0) {
            html += '<p>Nincs elérhető adat a járatokról.</p>';
          } else {
            html += `<table>
              <thead>
                <tr>
                  <th>Vonat</th>
                  <th>Útvonal</th>
                  <th>Indulás (menetrend)</th>
                  <th>Indulás (valós)</th>
                  <th>Érkezés (menetrend)</th>
                  <th>Érkezés (valós)</th>
                </tr>
              </thead>
              <tbody>`;

            trains.forEach(train => {
              const { schedule, real, info, line } = train;
              html += `<tr>
                <td>${info.code} (${info.info})</td>
                <td>${line}</td>
                <td>${schedule?.departure || '-'}</td>
                <td>${real?.departure || '-'}</td>
                <td>${schedule?.arrival || '-'}</td>
                <td>${real?.arrival || '-'}</td>
              </tr>`;
            });

            html += `</tbody></table>`;
          }

          resultsDiv.innerHTML = html;
        })
        .catch(err => {
          resultsDiv.innerHTML = `<p>Hiba történt az adatok lekérése közben.</p>`;
          console.error(err);
        });
    }
  </script>
</body>
</html>
