<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>BKK útvonalterv GPS alapján</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    pre { background: #f0f0f0; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body>
  <h2>BKK útvonalterv GPS alapján</h2>
  <p id="output">Helyzet lekérése...</p>
  <pre id="result">Várakozás az adatokra...</pre>

  <script>
    const apiKey = "05f00c85-2177-4345-9103-e72960f3918d";
    async function getLocationAndFetchTrip() {
      const output = document.getElementById("output");
      const result = document.getElementById("result");

      if (!navigator.geolocation) {
        output.textContent = "A böngésződ nem támogatja a geolokációt.";
        return;
      }

      navigator.geolocation.getCurrentPosition(async function(position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        output.textContent = `Koordináta: ${lat}, ${lon}`;

        const encodedFrom = `Poz%C3%ADci%C3%B3::${lat},${lon}`;
        const toPlace = "Nyugati::47.511467,19.058119";

        const url = `https://futar.bkk.hu/api/query/v1/ws/otp/api/where/plan-trip?wheelchair=false&appVersion=1.0&fromPlace=${encodedFrom}&walkProfile=FAST&shouldBuyTickets=false&maxTransfers=5&version=4&mode=WALK,BUS,TRAM,SUBWAY,TROLLEYBUS,SUBURBAN_RAILWAY,COACH,RAIL,FERRY&arriveBy=true&minResult=1&showIntermediateStops=true&optimize=QUICK&includeReferences=true&toPlace=${encodeURIComponent(toPlace)}&time=14:06&key=${apiKey}`;

        try {
          const response = await fetch(url);
          if (!response.ok) throw new Error(`Hiba a lekérés során: ${response.status}`);
          const data = await response.json();
          result.textContent = JSON.stringify(data, null, 2); // szépen formázott JSON
        } catch (error) {
          result.textContent = "Hiba történt: " + error.message;
        }
      }, function(error) {
        output.textContent = "Hiba a helymeghatározás során: " + error.message;
      });
    }

    // Automatikus indítás oldalbetöltéskor
    window.onload = getLocationAndFetchTrip;
  </script>
</body>
</html>
